!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).mrkrjs=t()}(this,(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e){return 3===e.nodeType}function s(e){return!(!e||"number"!=typeof e.startOffset||"number"!=typeof e.endOffset)}var l=function e(t){var n=[];for(t=t.firstChild;t;t=t.nextSibling)o(t)?n.push(t):n=n.concat(e(t));return n},a=function(){function i(t,r){var o=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e(this,i),n(this,"getAbsoluteOffsets",(function(e,t,n,r){var i,s,a=l(o.element),f=0;return a.some((function(o){return!(null==o||!o.textContent||(o===e&&(i=f+t),o===n?(s=f+r,0):(f+=o.textContent.length,1)))})),i&&s?{startOffset:i,endOffset:s}:{}}));var a=s.onSelection,f=s.maximum,u=void 0===f?void 0:f,h=s.minimum,c=void 0===h?void 0:h,d=s.overlap,g=void 0===d||d,m=s.selectionEnabled,v=void 0===m||m;if(!t)throw new Error("Element is required.");if(!r)throw new Error("Class name is required.");this.element=t,this.highlightClass=r,this.selectionEnabled=v,this.maximum=u,this.minimum=c,this.overlap=g,this.onSelection=a,this.handlePointerUp=this.handlePointerUp.bind(this),this.setElement(t)}var a,f;return a=i,f=[{key:"handlePointerUp",value:function(e){if(this.selectionEnabled){var t=this.highlight();this.onSelection&&this.onSelection(e,t)}}},{key:"getHighlightedNodes",value:function(e){return this.element?Array.from(this.element.querySelectorAll(".".concat(e||this.highlightClass))):[]}},{key:"highlightNode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(!e)return[];var r=e.substring(t,n);if(r.length>0){var i=document.createElement("SPAN");i.classList.add(this.highlightClass);var o=document.createTextNode(e.substring(0,t)),s=document.createTextNode(r),l=document.createTextNode(e.substring(n));i.appendChild(s);var a=[];return o.textContent&&a.push(o),a.push(i),l.textContent&&a.push(l),a}return[document.createTextNode(e)]}},{key:"register",value:function(){this.element.addEventListener("pointerup",this.handlePointerUp)}},{key:"unregister",value:function(){this.element.removeEventListener("pointerup",this.handlePointerUp)}},{key:"setClassName",value:function(e){this.highlightClass=e}},{key:"getData",value:function(e){if(!this.element)return[];var t=l(this.element),n=this.getHighlightedNodes(e).reduce((function(e,t){return[].concat(r(e),r(l(t)))}),[]),i=0,o=!1,s=[];return t.some((function(e,r){if(!e.textContent)return!1;var l=n.find((function(t){return t===e}));return l?(o?(s[s.length-1].text+=e.textContent,s[s.length-1].nodes.push(l)):(s.push({startOffset:i,text:e.textContent,nodes:[l]}),o=!0),r===t.length-1&&(s[s.length-1].endOffset=i+e.textContent.length)):o&&(s[s.length-1].endOffset=i,o=!1),i+=e.textContent.length,!1})),s}},{key:"setElement",value:function(e){this.unregister(),this.element=e,this.register()}},{key:"clear",value:function(e){if(this.element){var t=null==e?void 0:e.filter((function(e){return s(e)})),n=this.getHighlightedNodes(),i=l(this.element);if(t){var o=0;i.some((function(e){var i;if(t.find((function(e){return s(e)&&o>=e.startOffset&&o<=e.endOffset}))){var l=n.find((function(t){return!!Array.from(t.childNodes).find((function(t){return t===e}))}));l&&l.replaceWith.apply(l,r(Array.from(l.childNodes)))}var a=t.map((function(e){return e.endOffset})).filter((function(e){return"number"==typeof e}));return o>Math.max.apply(Math,r(a))||(o+=(null===(i=e.textContent)||void 0===i?void 0:i.length)||0,!1)}))}else n.forEach((function(e){e.replaceWith.apply(e,r(Array.from(e.childNodes)))}))}}},{key:"highlight",value:function(){var e=window.getSelection(),t=[];if(!e)return t;if(!this.element)return console.error(new Error("Container element not defined for highlighter.")),t;var n=e.getRangeAt(0),r=n,i=r.startContainer,l=r.endContainer;if(o(i)&&o(l)){if(i===l&&n.endOffset===n.startOffset)return t;var a=this.getAbsoluteOffsets(i,n.startOffset,l,n.endOffset);if(e.removeAllRanges(),a.startOffset&&a.endOffset){var f=a.endOffset-a.startOffset,u=a.startOffset,h=a.endOffset;if(this.minimum&&!(f>=this.minimum)||this.maximum&&!(f<=this.maximum))return t;if(!this.overlap&&this.getData().some((function(e){return e.startOffset&&e.endOffset&&(u>e.startOffset&&u<e.endOffset||h>e.startOffset&&h<e.endOffset)})))return t}return s(a)&&this.highlightRange(a.startOffset,a.endOffset),this.getData()}return t}},{key:"highlightRange",value:function(e,t){var n=this;if(!this.element)return console.error(new Error("Container element not defined for highlighter.")),[];var i=l(this.element),o=0,s=!1;return i.some((function(i){if(!i.textContent)return!1;var l=o+i.textContent.length;if(e>=o&&e<l){var a=n.highlightNode(i.textContent,e-o,t-o);i.replaceWith.apply(i,r(a)),s=!0}if(t>=o&&t<l){var f=n.highlightNode(i.textContent,0,t-o);return i.replaceWith.apply(i,r(f)),!0}if(s){var u=n.highlightNode(i.textContent,0,i.textContent.length);i.replaceWith.apply(i,r(u))}return o=l,!1})),this.getData()}},{key:"getSelectionEnabled",value:function(){return this.selectionEnabled}},{key:"toggleSelection",value:function(e){this.selectionEnabled=void 0===e?!this.selectionEnabled:e}},{key:"enableSelection",value:function(){this.selectionEnabled=!0}},{key:"disableSelection",value:function(){this.selectionEnabled=!1}}],f&&t(a.prototype,f),Object.defineProperty(a,"prototype",{writable:!1}),i}();return a}));
//# sourceMappingURL=bundle.umd.min.js.map
