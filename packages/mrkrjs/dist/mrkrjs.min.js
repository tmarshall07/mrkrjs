!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("tslib")):"function"==typeof define&&define.amd?define(["tslib"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).mrkrjs=e(t.tslib)}(this,(function(t){"use strict";function e(t){return 3===t.nodeType}function n(t){return!(!t||"number"!=typeof t.startOffset||"number"!=typeof t.endOffset)}var i=function(t){var n=[];for(t=t.firstChild;t;t=t.nextSibling)e(t)?n.push(t):n=n.concat(i(t));return n};return function(){function r(t){void 0===t&&(t={});var e=this;this.getAbsoluteOffsets=function(t,n,r,o){var s,f,h=i(e.element),l=0;return h.some((function(e){return!!(null==e?void 0:e.textContent)&&(e===t&&(s=l+n),e===r?(f=l+o,!0):(l+=e.textContent.length,!1))})),s&&f?{startOffset:s,endOffset:f}:{}};var n=t.element,r=void 0===n?document.body:n,o=t.className,s=void 0===o?"highlight":o,f=t.onSelection,h=t.maximum,l=void 0===h?void 0:h,a=t.minimum,u=void 0===a?void 0:a,d=t.overlap,c=void 0===d||d;this.element=r,this.highlightClass=s,this.selectionEnabled=!1,this.maximum=l,this.minimum=u,this.overlap=c,this.onSelection=f,this.handlePointerUp=this.handlePointerUp.bind(this),this.setElement(r)}return r.prototype.handlePointerUp=function(t){if(this.selectionEnabled){var e=this.highlight();this.onSelection&&this.onSelection(t,e)}},r.prototype.getHighlightedNodes=function(t){return this.element?Array.from(this.element.querySelectorAll(".".concat(t||this.highlightClass))):[]},r.prototype.highlightNode=function(t,e,n){if(void 0===t&&(t=""),!t)return[];var i=t.substring(e,n);if(i.length>0){var r=document.createElement("SPAN");r.classList.add(this.highlightClass);var o=document.createTextNode(t.substring(0,e)),s=document.createTextNode(i),f=document.createTextNode(t.substring(n));r.appendChild(s);var h=[];return o.textContent&&h.push(o),h.push(r),f.textContent&&h.push(f),h}return[document.createTextNode(t)]},r.prototype.register=function(){this.element.addEventListener("pointerup",this.handlePointerUp)},r.prototype.unregister=function(){this.element.removeEventListener("pointerup",this.handlePointerUp)},r.prototype.setClassName=function(t){this.highlightClass=t},r.prototype.getData=function(e){if(!this.element)return[];var n=i(this.element),r=this.getHighlightedNodes(e).reduce((function(e,n){return t.__spreadArray(t.__spreadArray([],e,!0),i(n),!0)}),[]),o=0,s=!1,f=[];return n.some((function(t,e){if(!t.textContent)return!1;var i=r.find((function(e){return e===t}));return i?(s?(f[f.length-1].text+=t.textContent,f[f.length-1].nodes.push(i)):(f.push({startOffset:o,text:t.textContent,nodes:[i]}),s=!0),e===n.length-1&&(f[f.length-1].endOffset=o+t.textContent.length)):s&&(f[f.length-1].endOffset=o,s=!1),o+=t.textContent.length,!1})),f},r.prototype.setElement=function(t){this.unregister(),this.element=t,this.register()},r.prototype.clear=function(t){if(this.element){var e=null==t?void 0:t.filter((function(t){return n(t)})),r=this.getHighlightedNodes(),o=i(this.element);if(e){var s=0;o.some((function(t){var i;if(e.find((function(t){return n(t)&&s>=t.startOffset&&s<=t.endOffset}))){var o=r.find((function(e){return!!Array.from(e.childNodes).find((function(e){return e===t}))}));o&&o.replaceWith.apply(o,Array.from(o.childNodes))}var f=e.map((function(t){return t.endOffset})).filter((function(t){return"number"==typeof t}));return s>Math.max.apply(Math,f)||(s+=(null===(i=t.textContent)||void 0===i?void 0:i.length)||0,!1)}))}else r.forEach((function(t){t.replaceWith.apply(t,Array.from(t.childNodes))}))}},r.prototype.highlight=function(){var t=window.getSelection(),i=[];if(!t)return i;if(!this.element)return console.error(new Error("Container element not defined for highlighter.")),i;var r=t.getRangeAt(0),o=r,s=o.startContainer,f=o.endContainer;if(e(s)&&e(f)){if(s===f&&r.endOffset===r.startOffset)return i;var h=this.getAbsoluteOffsets(s,r.startOffset,f,r.endOffset);if(t.removeAllRanges(),h.startOffset&&h.endOffset){var l=h.endOffset-h.startOffset,a=h.startOffset,u=h.endOffset;if(this.minimum&&!(l>=this.minimum)||this.maximum&&!(l<=this.maximum))return i;if(!this.overlap&&this.getData().some((function(t){return t.startOffset&&t.endOffset&&(a>t.startOffset&&a<t.endOffset||u>t.startOffset&&u<t.endOffset)})))return i}return n(h)&&this.highlightRange(h.startOffset,h.endOffset),this.getData()}return i},r.prototype.highlightRange=function(t,e){var n=this;if(!this.element)return console.error(new Error("Container element not defined for highlighter.")),[];var r=i(this.element),o=0,s=!1;return r.some((function(i){if(!i.textContent)return!1;var r=o+i.textContent.length;if(t>=o&&t<r){var f=n.highlightNode(i.textContent,t-o,e-o);i.replaceWith.apply(i,f),s=!0}return e>=o&&e<r?(f=n.highlightNode(i.textContent,0,e-o),i.replaceWith.apply(i,f),!0):(s&&(f=n.highlightNode(i.textContent,0,i.textContent.length),i.replaceWith.apply(i,f)),o=r,!1)})),this.getData()},r.prototype.getSelectionEnabled=function(){return this.selectionEnabled},r.prototype.toggleSelection=function(t){this.selectionEnabled=void 0===t?!this.selectionEnabled:t},r.prototype.enableSelection=function(){this.selectionEnabled=!0},r.prototype.disableSelection=function(){this.selectionEnabled=!1},r}()}));
//# sourceMappingURL=mrkrjs.min.js.map
